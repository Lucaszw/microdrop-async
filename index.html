<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <!-- Plugin Title -->
  <title>Microdrop Async</title>
  <script type="text/javascript" src="./bundle.web.js"></script>
</head>
<body>
</body>
<script type="text/javascript">
console.log("Creating new microdrop instance");
var m = new MicrodropAsync();
var p = m.protocol;

var getLastProtocol = async () => {
  var protocols = await p.protocols();
  var len = protocols.length;
  var name = protocols[len-1].name;
  var protocol = await p.getProtocolByName(name);
  console.log("success", protocol);
  return protocol;
}

var deleteProtocol = async () => {
  var protocols = await p.protocols();
  console.log("protocols", protocols);
  var len = protocols.length;
  var name = protocols[len-1].name;
  console.log("name", name);
  var payload = await p.deleteProtocol(name);
  console.log("success", payload);
  return payload;
};

var loadProtocol = async() => {
  var protocols = await p.protocols();
  var protocol = protocols[0];
  output = await p.loadProtocol(protocol);
  if (output.requireConfirmation) {
    console.log("Already exists, giving confirmation to override");
    output = await p.loadProtocol(protocol, true);
  }
  console.log("success", output);
  return output;
};

var newProtocol = async () => {
  const protocol = await p.newProtocol();
  console.log("success", protocol);
  return protocol;
};

var skeletons = async() => {
  const skeletons = await p.protocol_skeletons();
  console.log("success", skeletons);
  return skeletons;
};

var protocols = async() => {
  const protocols = await p.protocols();
  console.log("success", protocols);
  return protocols;
}

// if (action == "new") newProtocol();
// if (action == "del") deleteProtocol();
// if (action == "skeletons") skeletons();
// if (action == "protocols") protocols();

</script>
</html>
